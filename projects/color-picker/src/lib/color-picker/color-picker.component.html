<div #dialogPopup
    class="color-picker"
    (click)="$event.stopPropagation()"
    [ngStyle]="{
        visibility: hidden || !show ? 'hidden' : 'visible',
        'top.px': top || 0,
        'left.px': left || 0,
        position: position || undefined,
        width: cpWidth || 'auto',
        height: cpHeight || 'auto'
    }">
    <div *ngIf="cpDialogDisplay == dialogDisplay.popup"
        class="color-picker__arrow"
        [ngClass]="'color-picker__arrow--' + cpPosition"
        [ngStyle]="{ 
            top: arrowTop
        }"></div>
    <div *ngIf="cpColorMode == colorModeInternal.color"
        class="color-picker__sv"
        cpSlider
        [rgX]="1"
        [rgY]="1"
        (newValue)="onColorChange($event)"
        (dragStart)="onDragStart('saturation-lightness')"
        (dragEnd)="onDragEnd('saturation-lightness')"
        [ngStyle]="{ 
            backgroundColor: hueSliderColor || ''
        }">
        <div class="color-picker__cursor color-picker__cursor--sv"
            [ngClass]="{ 'color-picker__cursor--light': svSliderLight }"
            [ngStyle]="{
                top: (slider?.v || 0) * 100 + '%',
                left: (slider?.s || 0) * 100 + '%'
            }"></div>
    </div>
    <div class="color-picker__controls">
        <div class="color-picker__selected">
            <div class="color-picker__selected-color">
                <div [ngStyle]="{ 
                    backgroundColor: selectedColor || ''
                }"><button *ngIf="cpAddColorButton"
                        [title]="cpAddColorButtonText"
                        class="color-picker__add-selected"
                        [ngClass]="{ 'color-picker__add-selected--light': alphaSliderLight }"
                        [disabled]="cpPresetColors && cpPresetColors.length >= cpMaxPresetColorsLength"
                        (click)="onAddPresetColor($event, selectedColor)">+</button></div>
            </div>
        </div>
        <div class="color-picker__hav">
            <div *ngIf="cpColorMode == colorModeInternal.color"
                class="color-picker__slider color-picker__slider--hue"
                cpSlider
                [rgX]="1"
                (newValue)="onHueChange($event)"
                (dragStart)="onDragStart('hue')"
                (dragEnd)="onDragEnd('hue')">
                <div class="color-picker__cursor"
                    [ngClass]="{ 'color-picker__cursor--light': hueSliderLight }"
                    [ngStyle]="{
                        left: (slider?.h || 0) * 100 + '%'
                    }"></div>
            </div>
            <div *ngIf="cpColorMode == colorModeInternal.grayscale"
                class="color-picker__slider color-picker__slider--value"
                cpSlider
                [rgX]="1"
                (newValue)="onValueChange($event)"
                (dragStart)="onDragStart('value')"
                (dragEnd)="onDragEnd('value')">
                <div class="color-picker__cursor"
                    [ngClass]="{ 'color-picker__cursor--light': valueSliderLight }"
                    [ngStyle]="{
                        left: (1 - (slider?.v || 0)) * 100 + '%'
                    }"></div>
            </div>
            <div *ngIf="cpAlphaChannel != alphaChannel.disabled"
                class="color-picker__slider color-picker__slider--alpha"
                cpSlider
                [rgX]="1"
                (newValue)="onAlphaChange($event)"
                (dragStart)="onDragStart('alpha')"
                (dragEnd)="onDragEnd('alpha')">
                <div class="color-picker__slider--alpha-bg"
                    [ngStyle]="{
                        backgroundImage: alphaSliderColor || ''
                    }">
                    <div class="color-picker__cursor"
                        [ngClass]="{ 'color-picker__cursor--light': alphaSliderLight }"
                        [ngStyle]="{
                            left: (slider?.a || 0) * 100 + '%'
                        }"></div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="!cpDisableInput && (cpColorMode == colorModeInternal.color || cpColorMode == colorModeInternal.grayscale)"
        class="color-picker__inputs">
        <div class="color-picker__input-fields">
            <ng-container *ngIf="cpColorMode == colorModeInternal.grayscale; else formatSwitch">
                <div class="color-picker__input-field">
                    <input type="number"
                        pattern="[0-9]*"
                        min="0"
                        max="100"
                        cpText
                        [rg]="100"
                        [value]="hslaText?.l"
                        (keyup.enter)="onAcceptColor($event)"
                        (newValue)="onValueInput($event)" />
                    <span class="color-picker__input-field-label">V</span>
                </div>
                <div *ngIf="cpAlphaChannel != alphaChannel.disabled"
                    class="color-picker__input-field">
                    <input type="number"
                        pattern="[0-9]+([\.,][0-9]{1,2})?"
                        min="0"
                        max="1"
                        step="0.1"
                        cpText
                        [rg]="1"
                        [value]="hslaText?.a"
                        (keyup.enter)="onAcceptColor($event)"
                        (newValue)="onAlphaInput($event)" />
                    <span class="color-picker__input-field-label">A</span>
                </div>
            </ng-container>
            <ng-template #formatSwitch>
                <ng-container [ngSwitch]="format">
                    <ng-container *ngSwitchCase="colorFormat.hsla">
                        <div class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]*"
                                min="0"
                                max="360"
                                cpText
                                [rg]="360"
                                [value]="hslaText?.h"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onHueInput($event)" />
                            <span class="color-picker__input-field-label">H</span>
                        </div>
                        <div class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]*"
                                min="0"
                                max="100"
                                cpText
                                [rg]="100"
                                [value]="hslaText?.s"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onSaturationInput($event)" />
                            <span class="color-picker__input-field-label">S</span>
                        </div>
                        <div class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]*"
                                min="0"
                                max="100"
                                cpText
                                [rg]="100"
                                [value]="hslaText?.l"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onLightnessInput($event)" />
                            <span class="color-picker__input-field-label">L</span>
                        </div>
                        <div *ngIf="cpAlphaChannel != alphaChannel.disabled"
                            class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]+([\.,][0-9]{1,2})?"
                                min="0"
                                max="1"
                                step="0.1"
                                cpText
                                [rg]="1"
                                [value]="hslaText?.a"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onAlphaInput($event)" />
                            <span class="color-picker__input-field-label">A</span>
                        </div>
                    </ng-container>
                    <ng-container *ngSwitchCase="colorFormat.rgba">
                        <div class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]*"
                                min="0"
                                max="255"
                                cpText
                                [rg]="255"
                                [value]="rgbaText?.r"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onRedInput($event)" />
                            <span class="color-picker__input-field-label">R</span>
                        </div>
                        <div class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]*"
                                min="0"
                                max="255"
                                cpText
                                [rg]="255"
                                [value]="rgbaText?.g"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onGreenInput($event)" />
                            <span class="color-picker__input-field-label">G</span>
                        </div>
                        <div class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]*"
                                min="0"
                                max="255"
                                cpText
                                [rg]="255"
                                [value]="rgbaText?.b"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onBlueInput($event)" />
                            <span class="color-picker__input-field-label">B</span>
                        </div>
                        <div *ngIf="cpAlphaChannel != alphaChannel.disabled"
                            class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]+([\.,][0-9]{1,2})?"
                                min="0"
                                max="1"
                                step="0.1"
                                cpText
                                [rg]="1"
                                [value]="hslaText?.a"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onAlphaInput($event)" />
                            <span class="color-picker__input-field-label">A</span>
                        </div>
                    </ng-container>
                    <ng-container *ngSwitchDefault>
                        <div class="color-picker__input-field">
                            <input cpText
                                [value]="hexText"
                                (blur)="onHexInput(null)"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onHexInput($event)" />
                            <span class="color-picker__input-field-label">Hex</span>
                        </div>
                        <div *ngIf="cpAlphaChannel == alphaChannel.forced"
                            class="color-picker__input-field">
                            <input type="number"
                                pattern="[0-9]+([\.,][0-9]{1,2})?"
                                min="0"
                                max="1"
                                step="0.1"
                                cpText
                                [rg]="1"
                                [value]="hexAlpha"
                                (keyup.enter)="onAcceptColor($event)"
                                (newValue)="onAlphaInput($event)" />
                            <span class="color-picker__input-field-label">A</span>
                        </div>
                    </ng-container>
                </ng-container>
            </ng-template>
        </div>
        <div *ngIf="cpColorMode == colorModeInternal.color"
            class="color-picker__input-type">
            <span class="color-picker__input-type-arrow"
                (click)="onFormatToggle(1)"></span>
            <span class="color-picker__input-type-arrow"
                (click)="onFormatToggle(-1)"></span>
        </div>
    </div>

    <div *ngIf="cpPresetColors?.length || cpAddColorButton"
        class="preset-area">
        <hr>

        <div class="preset-label">{{cpPresetLabel}}</div>

        <div *ngIf="cpPresetColors?.length">
            <div *ngFor="let color of cpPresetColors"
                class="preset-color"
                [style.backgroundColor]="color"
                (click)="setColorFromString(color)">
                <span *ngIf="cpAddColorButton"
                    class=""
                    (click)="onRemovePresetColor($event, color)"></span>
            </div>
        </div>

        <div *ngIf="!cpPresetColors?.length && cpAddColorButton"
            class="">{{cpPresetEmptyMessage}}</div>
    </div>

    <div *ngIf="cpOKButton || cpCancelButton"
        class="button-area">
        <button *ngIf="cpCancelButton"
            type="button"
            class=""
            (click)="onCancelColor($event)">{{cpCancelButtonText}}</button>

        <button *ngIf="cpOKButton"
            type="button"
            class=""
            (click)="onAcceptColor($event)">{{cpOKButtonText}}</button>
    </div>
</div>
